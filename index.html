<html><header><script type="module">
window.onload = () => {

let encrypt=async(plaintext,password)=>{
let ptUtf8 = new TextEncoder().encode(plaintext);
let pwUtf8 = new TextEncoder().encode(password);
let pwHash = await window.crypto.subtle.digest('SHA-256', pwUtf8);
let iv = window.crypto.getRandomValues(new Uint8Array(16));
let alg = { name: 'AES-CBC', iv: iv };
let key = await window.crypto.subtle.importKey('raw', pwHash, alg, false, ['encrypt']);
let ctBuffer = await window.crypto.subtle.encrypt(alg, key, ptUtf8);
let ctArray = new Uint8Array(ctBuffer);
let ctBase64 = btoa(String.fromCharCode(...ctArray));
let ivHex = Array.from(iv).map(b => ('00' + b.toString(16)).slice(-2)).join('');
return ivHex + ctBase64;
};

let decrypt=async(ciphertext,password)=>{
let ivHex = ciphertext.slice(0, 32);
let ctBase64 = ciphertext.slice(32);
let iv = new Uint8Array(ivHex.match(/.{1,2}/g).map(byte => parseInt(byte, 16)));
let ctStr = atob(ctBase64);
let ctArray = new Uint8Array(ctStr.split('').map(c => c.charCodeAt(0)));
let pwUtf8 = new TextEncoder().encode(password);
let pwHash = await window.crypto.subtle.digest('SHA-256', pwUtf8);
let alg = { name: 'AES-CBC', iv: iv };
let key = await window.crypto.subtle.importKey('raw', pwHash, alg, false, ['decrypt']);
let ptBuffer = await window.crypto.subtle.decrypt(alg, key, ctArray);
let plaintext = new TextDecoder().decode(ptBuffer);
return plaintext;
};

let $=(e)=>document.querySelector(e);
let $$=(e,ee)=>$(e).querySelector(ee);
let $f=(e)=>[...document.querySelectorAll('*')].filter(a=>a.value==e||a.innerText==e)[0];
let c=async(t,k)=>await encrypt(t,k);
let d=async(t,k)=>await decrypt(t,k);
let v=async(t,k,h)=>t===await decrypt(h,k);

let ls={
set:(a,b)=>{localStorage.setItem(a,JSON.stringify(b));},
get:(a)=>{return JSON.parse(localStorage.getItem(a));},
remove:(a)=>{localStorage.removeItem(a);},
};

let config={
hashusr:"",
hashpwd:"",
logged:false,
};

let update=()=>{
$("#logged").checked=config.logged;
$("#hashusr").value=config.hashusr;
$("#hashpwd").value=config.hashpwd;
$$("#signin","fieldset").disabled=config.logged;
$$("#login","fieldset").disabled=config.logged;
$$("#logout","fieldset").disabled=!config.logged;
};

$("#config").onsubmit=async(e)=>{
e.preventDefault();
let data=Object.fromEntries(new FormData(e.target));
config.logged=data.logged;
config.hashusr=data.hashusr;
config.hashpwd=data.hashpwd;
update();
};

$("#signin").onsubmit=async(e)=>{
e.preventDefault();
let data=Object.fromEntries(new FormData(e.target));
config.logged=!config.logged;
config.hashusr=await c(data.usr,data.usr);
config.hashpwd=await c(data.pwd,data.pwd);
update();
e.target.reset();
};

$("#login").onsubmit=async(e)=>{
e.preventDefault();
let data=Object.fromEntries(new FormData(e.target));
config.logged=await v(data.usr,data.usr,config.hashusr)==await v(data.pwd,data.pwd,config.hashpwd)==true;
update();
e.target.reset();
};

$("#logout").onsubmit=async(e)=>{
e.preventDefault();
config.logged=false;
update();
};

$("#clear").onsubmit=async(e)=>{
e.preventDefault();
config.logged=!config.logged;
config.hashusr="";
config.hashpwd="";
update();
};

};
</script></header><body style="font-family: Monospace;">
<form id="config" style="width: fit-content;">
<fieldset>
<legend>config</legend>
<label for="logged">logged:
<input type="checkbox" id="logged" />
</label>
<br />
<label for="hashusr">hashusr:
<input type="password" id="hashusr" />
</label>
<br />
<label for="hashpwd">hashpwd:
<input type="password" id="hashpwd" />
</label>
<span style="display: flex; justify-content: right;">
<input type="submit" />
</span>
</fieldset>
</form>

<br/>

<form id="signin" style="width: fit-content;">
<fieldset>
<legend>signin</legend>
<input type="text" name="usr" placeholder="username" required />
<br />
<input type="password" name="pwd" placeholder="password" required />
<br />
<span style="display: flex; justify-content: right;">
<input type="submit" />
</span>
</fieldset>
</form>

<br />

<form id="login" style="width: fit-content;">
<fieldset disabled>
<legend>login</legend>
<input type="text" name="usr" placeholder="username" required />
<br />
<input type="password" name="pwd" placeholder="password" required />
<br />
<span style="display: flex; justify-content: right;">
<input type="submit" />
</span>
</fieldset>
</form>

<br />

<form id="logout" style="width: fit-content;">
<fieldset disabled>
<legend>logout</legend>
<span style="display: flex; justify-content: right;">
<input type="submit" />
</span>
</fieldset>
</form>

<br />

<form id="clear" style="width: fit-content;">
<fieldset>
<legend>clear</legend>
<span style="display: flex; justify-content: right;">
<input type="submit" />
</span>
</fieldset>
</form>

</body></html>
